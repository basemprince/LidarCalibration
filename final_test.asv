imagePath = fullfile('/home', 'driverless', 'Documents', 'MATLAB', 'Examples', 'R2020b', 'lidar', 'LidarCameraCalibrationExample', 'images_test');
ptCloudPath = fullfile('/home', 'driverless', 'Documents', 'MATLAB', 'Examples', 'R2020b', 'lidar', 'LidarCameraCalibrationExample', 'point_cloud_test');
%cameraParamsPath = fullfile(imagePath, 'camera_params.mat');

%intrinsic = load(cameraParamsPath); % Load camera intrinsics
imds = imageDatastore(imagePath); % Load images using imageDatastore
pcds = fileDatastore(ptCloudPath, 'ReadFcn', @pcread); % Load point cloud files

imageFileNames = imds.Files;
ptCloudFileNames = pcds.Files;

squareSize = 67; % Square size of the checkerboard
 
% Set random seed to generate reproducible results.
rng('default');

[imageCorners3d, checkerboardDimension, dataUsed] = ...
    estimateCheckerboardCorners3d(imageFileNames, cameraParams, squareSize);
imageFileNames = imageFileNames(dataUsed); % Remove image files that are not used

helperShowImageCorners(imageCorners3d, imageFileNames, cameraParams);

% Extract ROI from the detected image corners
roi = helperComputeROI(imageCorners3d, 5);
 
% Filter point cloud files corresponding to the detected images
ptCloudFileNames = ptCloudFileNames(dataUsed);

ptCloudPlane = pointCloud(brushedData);
tform = estimateLidarCameraTransform(ptCloudPlane, imageCorners3d);

imPts = projectLidarPointsOnImage(ptCloudPlane, cameraParams.Intrinsics, tform);

figure
imshow(imageFileNames )
